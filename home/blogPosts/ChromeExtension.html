<div>

    <h1>Chrome extension 開發</h1>

    <h2>適合閱讀對象</h2>
    <p>1.對HTML/CSS/Javascript有最基本的理解，會call function、用jQuery，差不多就能上工了</p>
    <p>2.有耐心看很多英文，因為在過程中需要什麼功能都要去stackoverflow上面找、答案又時常是指向google的API document，你只要把他們都看懂就能解決99%以上的問題了！(或是知道不可能成功)，剩下的1%就要靠你用英文發問來把這個問題貢獻給社群、方便下一個遇到這個問題的人找到答案了！</p>

    <h2>前言</h2>
    <p>chrome extension的開發是目前最有趣的一次經驗，因為之前Android摸得算很熟了(血淚)，所以在看google document跟寫manifest時沒遇到太多困難，然後之後就爆炸了(哈哈)</p>

    <h2>那就開始吧！</h2>

    <p>在extension的開發中可以看見google對於權限的堅持，"要用什麼，就要聲明你要什麼權限"這不只是體現在manifest裡面要寫permission，更體現在chrome extension的架構中</p>

    <p>簡單而言，chrome extension共有三大架構(可能還有其他的，但還沒需要用到過)：</p>
    <p>background script, popup script, content script</p>
    <p>說真的看到都叫script就直接臉歪了，不過其實沒那麼難懂，簡單做個一一對應的話：</p>
    <ul>
        <li>background script -> server</li>
        <li>content script -> client</li>
        <li>popup script -> client端的app</li>
    </ul>>
    <p>content script 跟 popup script 看起來真的很類似，但本質上完全不同，等下會解釋</p>

    <!--Content Script-->

    <h2>Content script</h2>

    <p>content script會內嵌至各自網頁的內容中，變成網頁的一部分，只要你的extension是開啟的，網頁裡面就會內嵌content script。</p>
    <p>但他的缺陷是只能用非常少數的 chrome API，而且chrome會阻止content script直接做外部連結，你要寫http request特別去抓你要的外部檔案。因為太麻煩了，所以我個人都直接使用chrome 的 “sendMessage” (那個少數能用的API之一)，叫background script幫我做我要的工作。</p>
    <h3>content script 為什麼必要存在？</h3>
    <p>“因為當你想要修改使用者瀏覽的網頁時，你也只能用content script去做修改”，否則，根本不同頁面的script要怎麼找到你要的tag呢？(你可能會有疑問：popup script 不是在同一個頁面上嗎？等等再說)</p>

    <!--Popup Script-->

    <h2>Popup Script</h2>

    <p>popup script可以自由使用所有chrome API，但他有一個更討厭的特性：「只有你去右上角把他點開時，他才存在」，這也是為什麼我說他是client端的app。只要使用者不去點右上角，你的popup script就完全沒用，無法執行，也無法接收，所以通常是要做一些設定時才會把程式寫在這邊。</p>
    <p>另外，一個對popup script的常見誤會是，他其實自己是一個tab，他有自己的html file，自己的獨立環境，所以他其實沒辦法直接對目前的瀏覽頁面做任何干涉</p>

    <!--Background Script-->

    <h2>Background Script</h2>

    <p>background script會always on，並且唯一存在，生命週期是開啟瀏覽器一開啟到關閉瀏覽器完全被關閉(process killed)，所以我說他是server，他負責的是補足popup script 與content script的不足。</p>
    <p>popup script不是always on，所以background script負責隨時接受操作指示，content script不能使用大多數 chrome API，所以background script 幫忙做，此外background script也能擔任暫時儲存的工作(因為他是唯一且持續存在的)，雖然終究在某些時間點你要把資料存進chrome storage裡面</p>


    <h4>對於三種script更加詳細的說明：<a href="http://stackoverflow.com/questions/9915311/chrome-extension-code-vs-content-scripts-vs-injected-scripts">Link to stackoverflow</a></h4>

    <!--basic concepts-->

    <h2>chrome extension的基本架構與概念</h2>

    <p>基本上除了用的是不同的API和語言是JS以外，我覺得根本是在寫Android...</p>
    <p>基本概念都是event trigger：「沒有操作，沒有回饋！」
    <p>chrome API 提供了大量的event：分頁開啟、分頁讀取完成、更換分頁、關閉分頁、滑鼠、鍵盤......不勝枚舉，功能實作基本上都是：「你覺得什麼時間點需要？ -> 權限夠不夠？目標有沒有活著？ -> 開始實作」，目前還沒遇到想要的event卻找不到的困境，基本上就是個大API時代，「想要的話就去找吧，我通通都藏在document裡」，雖然我個人有一半的時間是在stackoverflow裡面打滾(笑)。

    <h2>Chrome API 的煩人之處</h2>

    <p>雖然chrome API很猛，但他同時卻很惱人。</p>
    <p>WHY?</p>
    <p>因為他在document開始就聲明自己絕大多數的API都是非即時的，意思就是：「你call了，可是我不知道多久後會完成耶呵呵...」</p>
    <p>“。”</p>
    <p>幸好JS有callback！chrome extension 的API基本上也都提供callback的parameter，記得乖乖callback，就沒煩惱囉。然後就會出現以下的code：</p>
    <pre><code>
        chrome1(function(){
            // blablabla
            chrome2(function(){
                //blablabla
                chrome3(function(){
                    //blablabla
                    .
                    .
                    .
                });
            });
        });
    </code></pre>
    <p>「真是超級醜的醜。」</p>

    <h2>Debug</h2>

    <p>雖然有點想說”去看document啦”，但說真的這方面document其實整理得不是很好，所以還是把方向指一下。</p>
    <p>對popup script而言，你只要對右上角的圖標按右鍵->檢查彈出式視窗，OK</p>
    <p>對background script而言，你要先進到管理擴充功能的頁面，你的擴充功能裡面會有一個”背景頁面”的按鈕，按下去就OK啦</p>
    <p>對content script而言，因為他是插入至網頁內容中的，只要向平常一樣打開網頁的debugger->切換到source頁面然後你會發現左上角有一串你平常都沒注意到的小標籤，上面寫的 "source","content script","snippets”，content script點下去翻一翻就OK啦！</p>


    <h2>結語</h2>
    <p>基本上，對於有HTML/CSS/Javascript基礎的人，我認為這篇簡單教學文(?)應該把大多數剛入手時的會需要面對的問題、關鍵字都列出了，有了這些初步的認識後，想必已能開始著手Chrome Extension的開發了！</p>

</div>